/*
  angular-file-process v0.0.1
  https://github.com/madwyn/angular-file-process
 */

!function(a,b){return"function"==typeof define&&define.amd?void define("angular-file-process",["angular"],function(a){return b(a)}):b(a)}(angular||null,function(a){var b=a.module("angularFileProcess",[]);return b.directive("ngFileDrop",["$fileProcess",function(b){"use strict";return{link:b.isHTML5?function(a,b,c){b.bind("drop",function(b){var d=b.dataTransfer?b.dataTransfer:b.originalEvent.dataTransfer;d&&(b.preventDefault(),b.stopPropagation(),a.$broadcast("file:removeoverclass"),a.$emit("file:add",d.files,a.$eval(c.ngFileDrop)))}).bind("dragover",function(b){var c=b.dataTransfer?b.dataTransfer:b.originalEvent.dataTransfer;b.preventDefault(),b.stopPropagation(),c.dropEffect="copy",a.$broadcast("file:addoverclass")}).bind("dragleave",function(){a.$broadcast("file:removeoverclass")})}:a.noop}}]),b.directive("ngFileOver",function(){"use strict";return{link:function(a,b,c){a.$on("file:addoverclass",function(){b.addClass(c.ngFileOver||"ng-file-over")}),a.$on("file:removeoverclass",function(){b.removeClass(c.ngFileOver||"ng-file-over")})}}}),b.directive("ngFileSelect",["$fileProcess",function(a){return{link:function(b,c,d){a.isHTML5?c.bind("change",function(){var a=this.files,e=b.$eval(d.ngFileSelect);b.$emit("file:add",a,e),c.attr("multiple")&&c.prop("value",null)}):(c.removeAttr("multiple"),c.bind("change",function(){var a=this,c=b.$eval(d.ngFileSelect);b.$emit("file:add",a,c)})),c.prop("value",null)}}}]),b.factory("$fileProcess",["$rootScope","$window",function(b,c){"use strict";function d(c){a.extend(this,{autoStart:!1,removeAfterProc:!1,Processor:{_construct:function(){},_destruct:function(){},_process:function(){this.proc.trigger(i.IN_SUCCESS,this)},_abort:function(){this.proc.trigger(i.IN_ABORT,this)}},scope:b,itemList:new e({}),filters:[],_status:h.UNPROCESSED,_timestamp:Date.now()},c),"undefined"==typeof this.Processor.prototype?a.extend(f.prototype,this.Processor):a.extend(f.prototype,this.Processor.prototype),this.filters.unshift(this._queueLimitFilter),this.filters.unshift(this._emptyFileFilter),this.scope.$on("file:add",function(a,b,c){a.stopPropagation(),this.addFiles(b,c)}.bind(this)),this.bind(i.IN_PROGRESS,f.prototype._onProgress),this.bind(i.IN_ABORT,f.prototype._onAbort),this.bind(i.IN_ERROR,f.prototype._onError),this.bind(i.IN_SUCCESS,f.prototype._onSuccess),this.bind(i.IN_LOAD,f.prototype._onSuccess),this.bind(i.IN_COMPLETE,f.prototype._onSuccess),this.bind(i.PROC_PROGRESS,this._onProgress),this.bind(i.PROC_COMPLETE,this._onComplete)}function e(b){a.extend(this,{list:[],limit:Number.MAX_VALUE,_nextItemIdx:0},b)}function f(b){this.uid=g(),a.extend(this,{file:null,proc:{removeItem:function(){},trigger:function(){}},progress:0,_status:h.UNPROCESSED},b),this._construct()}d.prototype={constructor:d,isHTML5:!(!c.File||!c.FormData),bind:function(a,b){return this.scope.$on(this._timestamp+":"+a,b.bind(this))},trigger:function(a){arguments[0]=this._timestamp+":"+a,this.scope.$broadcast.apply(this.scope,arguments)},addFiles:function(b,c){var d=this.itemList.length(),e="length"in b?b:[b];a.forEach(e,function(b){var d=this.filters.length?this.filters.every(function(a){return a.call(this,b)},this):!0,e=new f(a.extend({file:b,proc:this},c));d?(this.trigger(i.BEFORE_ADDING_A_FILE,e),this.itemList.add(e),this.trigger(i.AFTER_ADDING_A_FILE,e)):this.trigger(i.WHEN_ADDING_A_FILE_FAILED,e)},this),this.itemList.length()>d?(this.trigger(i.AFTER_ADDING_ALL,this.itemList),this._updateProgress()):this._render(),this.autoStart&&this.processAll()},processItem:function(a){a.process()},processAll:function(){this.findItemsReadyToBeProcessed().forEach(function(a){a.setToBeProcessed()}),this._status=h.PROCESSING,this.trigger(i.BEFORE_PROCESSING_ALL,this),this._processNextItem()},abortItem:function(a){a.abort()},abortAll:function(){this.trigger(i.ABORT_ALL,this),this._status=h.ABORTED,this.findItemsInProcessing().forEach(function(a){a.abort()})},removeItem:function(a){a.destruct(),this.itemList.remove(a),this._updateProgress()},removeAll:function(){this.itemList.clear(),this._updateProgress()},_processNextItem:function(){if(this._status===h.PROCESSING){var a=this.findOneItemToBeProcessed();null!=a?this.processItem(a):(this._status=h.SUCCEEDED,this._onComplete(i.PROC_COMPLETE,a))}},_onProgress:function(a,b){this._updateProgress(b.progress)},_onComplete:function(a,b){switch(this.removeAfterProc&&this.removeItem(b),this._updateProgress(),this._status){case h.PROCESSING:return void this._processNextItem();case h.ABORTED:return void this.findItemsToBeProcessed().forEach(function(a){a.abort()});case h.SUCCEEDED:case h.ERROR:return void this.trigger(i.COMPLETE_ALL,this.itemList);default:return}},_updateProgress:function(a){if(this.removeAfterProc)this.progress=a||0;else{var b=this.itemList.length(),c=this.countItemsProcessed(),d=100/b,e=(a||0)*d/100;this.progress=Math.round(c*d+e)}this.trigger(i.PROGRESS_ALL,this,this.progress),this._render()},_render:function(){this.scope.$$phase||this.scope.$digest()},findItemsReadyToBeProcessed:function(){return this.itemList.filter(function(a){return a.isReady()})},findOneItemToBeProcessed:function(){for(var a=0;a<this.itemList.length();a++)if(this.itemList.get(a).isToBeProcessed())return this.itemList.get(a);return null},findItemsToBeProcessed:function(){return this.itemList.filter(function(a){return a.isToBeProcessed()})},findItemsInProcessing:function(){return this.itemList.filter(function(a){return a.isProcessing()})},countItemsProcessed:function(){var a=0;return this.itemList.list.forEach(function(b){b.isProcessed()&&a++}),a},_emptyFileFilter:function(b){return a.isElement(b)?!0:!!b.size},_queueLimitFilter:function(){return this.itemList.length()<this.itemList.limit}},e.prototype={constructor:e,add:function(a){this.list.push(a)},remove:function(a){var b=this.list.indexOf(a);this.removeByIndex(b)},get:function(a){return this.list[a]},appendArray:function(a){this.list=this.list.concat(a)},removeByIndex:function(a){a>-1&&this.list.splice(a,1)},clear:function(){for(;this.list.length>0;)this.list.pop()},filter:function(a){return this.list.filter(function(b){return a(b)})},length:function(){return this.list.length},indexOf:function(a){return this.list.indexOf(a)}};var g=function(){var a=0;return function(){return 0===arguments[0]&&(a=0),a++}}();f.prototype={constructor:f,destruct:function(){this.isProcessing()&&this.abort(),this._destruct()},remove:function(){this.proc.removeItem(this)},process:function(){(this.isReady()||this.isToBeProcessed())&&(this.proc.trigger(i.BEFORE_PROCESSING_ITEM,this),this._status=h.PROCESSING,this._process())},abort:function(){this.isProcessing()?this._abort():this._onAbort(i.IN_ABORT,this)},isReady:function(){return this._status===h.UNPROCESSED||this._status===h.ABORTED},isSuccess:function(){return this._status===h.SUCCEEDED},isError:function(){return this._status===h.ERROR},isAborted:function(){return this._status===h.ABORTED},isProcessed:function(){return this._status===h.SUCCEEDED||this._status===h.ERROR},isProcessing:function(){return this._status===h.PROCESSING},isToBeProcessed:function(){return this._status===h.TO_BE_PROCESSED},setToBeProcessed:function(){this._status=h.TO_BE_PROCESSED},_onProgress:function(a,b,c){b.progress=c,b.proc.trigger(i.PROC_PROGRESS,b),b.proc.trigger(i.PROGRESS_ITEM,b,c)},_onAbort:function(a,b){b._status=h.ABORTED,b.proc.trigger(i.PROC_COMPLETE,b),b.proc.trigger(i.ABORT_ITEM,b)},_onSuccess:function(a,b){b._status=h.SUCCEEDED,b.proc.trigger(i.PROC_COMPLETE,b),b.proc.trigger(i.SUCCESS_ITEM,b)},_onError:function(a,b){b._status=h.ERROR,b.proc.trigger(i.PROC_COMPLETE,b),b.proc.trigger(i.ERROR_ITEM,b)}};var h={UNPROCESSED:"unprocessed",ABORTED:"aborted",TO_BE_PROCESSED:"to_be_processed",PROCESSING:"processing",SUCCEEDED:"succeeded",ERROR:"error"},i={ABORT_ITEM:"abort_item",ABORT_ALL:"abort_all",ERROR_ITEM:"error_item",SUCCESS_ITEM:"success_item",PROGRESS_ITEM:"progress_item",PROGRESS_ALL:"progress_all",COMPLETE_ALL:"complete_all",BEFORE_ADDING_A_FILE:"before_adding_a_file",AFTER_ADDING_A_FILE:"after_adding_a_file",WHEN_ADDING_A_FILE_FAILED:"when_adding_a_file_failed",AFTER_ADDING_ALL:"after_adding_all",BEFORE_PROCESSING_ITEM:"before_processing_item",BEFORE_PROCESSING_ALL:"before_processing_all",IN_PROGRESS:"in:progress",IN_ABORT:"in:abort",IN_ERROR:"in:error",IN_SUCCESS:"in:success",IN_LOAD:"in:load",IN_COMPLETE:"in:complete",PROC_PROGRESS:"proc:progress",PROC_COMPLETE:"proc:complete"},j={};return j.create=function(a){return new d(a)},j.isHTML5=d.prototype.isHTML5,j.EVT=i,j.Item=f,j.Process=d,j.ItemList=e,j}]),b}),function(a,b){return"function"==typeof define&&define.amd?void define("angular-file-process",["angular"],function(a){return b(a)}):b(a)}(angular||null,function(a){var b=a.module("angularFileProcess",[]);return b.directive("ngFileDrop",["$fileProcess",function(b){"use strict";return{link:b.isHTML5?function(a,b,c){b.bind("drop",function(b){var d=b.dataTransfer?b.dataTransfer:b.originalEvent.dataTransfer;d&&(b.preventDefault(),b.stopPropagation(),a.$broadcast("file:removeoverclass"),a.$emit("file:add",d.files,a.$eval(c.ngFileDrop)))}).bind("dragover",function(b){var c=b.dataTransfer?b.dataTransfer:b.originalEvent.dataTransfer;b.preventDefault(),b.stopPropagation(),c.dropEffect="copy",a.$broadcast("file:addoverclass")}).bind("dragleave",function(){a.$broadcast("file:removeoverclass")})}:a.noop}}]),b.directive("ngFileOver",function(){"use strict";return{link:function(a,b,c){a.$on("file:addoverclass",function(){b.addClass(c.ngFileOver||"ng-file-over")}),a.$on("file:removeoverclass",function(){b.removeClass(c.ngFileOver||"ng-file-over")})}}}),b.directive("ngFileSelect",["$fileProcess",function(a){return{link:function(b,c,d){a.isHTML5?c.bind("change",function(){var a=this.files,e=b.$eval(d.ngFileSelect);b.$emit("file:add",a,e),c.attr("multiple")&&c.prop("value",null)}):(c.removeAttr("multiple"),c.bind("change",function(){var a=this,c=b.$eval(d.ngFileSelect);b.$emit("file:add",a,c)})),c.prop("value",null)}}}]),b.factory("$fileProcess",["$rootScope","$window",function(b,c){"use strict";function d(c){a.extend(this,{autoStart:!1,removeAfterProc:!1,Processor:{_construct:function(){},_destruct:function(){},_process:function(){this.proc.trigger(i.IN_SUCCESS,this)},_abort:function(){this.proc.trigger(i.IN_ABORT,this)}},scope:b,itemList:new e({}),filters:[],_status:h.UNPROCESSED,_timestamp:Date.now()},c),"undefined"==typeof this.Processor.prototype?a.extend(f.prototype,this.Processor):a.extend(f.prototype,this.Processor.prototype),this.filters.unshift(this._queueLimitFilter),this.filters.unshift(this._emptyFileFilter),this.scope.$on("file:add",function(a,b,c){a.stopPropagation(),this.addFiles(b,c)}.bind(this)),this.bind(i.IN_PROGRESS,f.prototype._onProgress),this.bind(i.IN_ABORT,f.prototype._onAbort),this.bind(i.IN_ERROR,f.prototype._onError),this.bind(i.IN_SUCCESS,f.prototype._onSuccess),this.bind(i.IN_LOAD,f.prototype._onSuccess),this.bind(i.IN_COMPLETE,f.prototype._onSuccess),this.bind(i.PROC_PROGRESS,this._onProgress),this.bind(i.PROC_COMPLETE,this._onComplete)}function e(b){a.extend(this,{list:[],limit:Number.MAX_VALUE,_nextItemIdx:0},b)}function f(b){this.uid=g(),a.extend(this,{file:null,proc:{removeItem:function(){},trigger:function(){}},progress:0,_status:h.UNPROCESSED},b),this._construct()}d.prototype={constructor:d,isHTML5:!(!c.File||!c.FormData),bind:function(a,b){return this.scope.$on(this._timestamp+":"+a,b.bind(this))},trigger:function(a){arguments[0]=this._timestamp+":"+a,this.scope.$broadcast.apply(this.scope,arguments)},addFiles:function(b,c){var d=this.itemList.length(),e="length"in b?b:[b];a.forEach(e,function(b){var d=this.filters.length?this.filters.every(function(a){return a.call(this,b)},this):!0,e=new f(a.extend({file:b,proc:this},c));d?(this.trigger(i.BEFORE_ADDING_A_FILE,e),this.itemList.add(e),this.trigger(i.AFTER_ADDING_A_FILE,e)):this.trigger(i.WHEN_ADDING_A_FILE_FAILED,e)},this),this.itemList.length()>d?(this.trigger(i.AFTER_ADDING_ALL,this.itemList),this._updateProgress()):this._render(),this.autoStart&&this.processAll()},processItem:function(a){a.process()},processAll:function(){this.findItemsReadyToBeProcessed().forEach(function(a){a.setToBeProcessed()}),this._status=h.PROCESSING,this.trigger(i.BEFORE_PROCESSING_ALL,this),this._processNextItem()},abortItem:function(a){a.abort()},abortAll:function(){this.trigger(i.ABORT_ALL,this),this._status=h.ABORTED,this.findItemsInProcessing().forEach(function(a){a.abort()})},removeItem:function(a){a.destruct(),this.itemList.remove(a),this._updateProgress()},removeAll:function(){this.itemList.clear(),this._updateProgress()},_processNextItem:function(){if(this._status===h.PROCESSING){var a=this.findOneItemToBeProcessed();null!=a?this.processItem(a):(this._status=h.SUCCEEDED,this._onComplete(i.PROC_COMPLETE,a))}},_onProgress:function(a,b){this._updateProgress(b.progress)},_onComplete:function(a,b){switch(this.removeAfterProc&&this.removeItem(b),this._updateProgress(),this._status){case h.PROCESSING:return void this._processNextItem();case h.ABORTED:return void this.findItemsToBeProcessed().forEach(function(a){a.abort()});case h.SUCCEEDED:case h.ERROR:return void this.trigger(i.COMPLETE_ALL,this.itemList);default:return}},_updateProgress:function(a){if(this.removeAfterProc)this.progress=a||0;else{var b=this.itemList.length(),c=this.countItemsProcessed(),d=100/b,e=(a||0)*d/100;this.progress=Math.round(c*d+e)}this.trigger(i.PROGRESS_ALL,this,this.progress),this._render()},_render:function(){this.scope.$$phase||this.scope.$digest()},findItemsReadyToBeProcessed:function(){return this.itemList.filter(function(a){return a.isReady()})},findOneItemToBeProcessed:function(){for(var a=0;a<this.itemList.length();a++)if(this.itemList.get(a).isToBeProcessed())return this.itemList.get(a);return null},findItemsToBeProcessed:function(){return this.itemList.filter(function(a){return a.isToBeProcessed()})},findItemsInProcessing:function(){return this.itemList.filter(function(a){return a.isProcessing()})},countItemsProcessed:function(){var a=0;return this.itemList.list.forEach(function(b){b.isProcessed()&&a++}),a},_emptyFileFilter:function(b){return a.isElement(b)?!0:!!b.size},_queueLimitFilter:function(){return this.itemList.length()<this.itemList.limit}},e.prototype={constructor:e,add:function(a){this.list.push(a)},remove:function(a){var b=this.list.indexOf(a);this.removeByIndex(b)},get:function(a){return this.list[a]},appendArray:function(a){this.list=this.list.concat(a)},removeByIndex:function(a){a>-1&&this.list.splice(a,1)},clear:function(){for(;this.list.length>0;)this.list.pop()},filter:function(a){return this.list.filter(function(b){return a(b)})},length:function(){return this.list.length},indexOf:function(a){return this.list.indexOf(a)}};var g=function(){var a=0;return function(){return 0===arguments[0]&&(a=0),a++}}();f.prototype={constructor:f,destruct:function(){this.isProcessing()&&this.abort(),this._destruct()},remove:function(){this.proc.removeItem(this)},process:function(){(this.isReady()||this.isToBeProcessed())&&(this.proc.trigger(i.BEFORE_PROCESSING_ITEM,this),this._status=h.PROCESSING,this._process())},abort:function(){this.isProcessing()?this._abort():this._onAbort(i.IN_ABORT,this)},isReady:function(){return this._status===h.UNPROCESSED||this._status===h.ABORTED},isSuccess:function(){return this._status===h.SUCCEEDED},isError:function(){return this._status===h.ERROR},isAborted:function(){return this._status===h.ABORTED},isProcessed:function(){return this._status===h.SUCCEEDED||this._status===h.ERROR},isProcessing:function(){return this._status===h.PROCESSING},isToBeProcessed:function(){return this._status===h.TO_BE_PROCESSED},setToBeProcessed:function(){this._status=h.TO_BE_PROCESSED},_onProgress:function(a,b,c){b.progress=c,b.proc.trigger(i.PROC_PROGRESS,b),b.proc.trigger(i.PROGRESS_ITEM,b,c)},_onAbort:function(a,b){b._status=h.ABORTED,b.proc.trigger(i.PROC_COMPLETE,b),b.proc.trigger(i.ABORT_ITEM,b)},_onSuccess:function(a,b){b._status=h.SUCCEEDED,b.proc.trigger(i.PROC_COMPLETE,b),b.proc.trigger(i.SUCCESS_ITEM,b)},_onError:function(a,b){b._status=h.ERROR,b.proc.trigger(i.PROC_COMPLETE,b),b.proc.trigger(i.ERROR_ITEM,b)}};var h={UNPROCESSED:"unprocessed",ABORTED:"aborted",TO_BE_PROCESSED:"to_be_processed",PROCESSING:"processing",SUCCEEDED:"succeeded",ERROR:"error"},i={ABORT_ITEM:"abort_item",ABORT_ALL:"abort_all",ERROR_ITEM:"error_item",SUCCESS_ITEM:"success_item",PROGRESS_ITEM:"progress_item",PROGRESS_ALL:"progress_all",COMPLETE_ALL:"complete_all",BEFORE_ADDING_A_FILE:"before_adding_a_file",AFTER_ADDING_A_FILE:"after_adding_a_file",WHEN_ADDING_A_FILE_FAILED:"when_adding_a_file_failed",AFTER_ADDING_ALL:"after_adding_all",BEFORE_PROCESSING_ITEM:"before_processing_item",BEFORE_PROCESSING_ALL:"before_processing_all",IN_PROGRESS:"in:progress",IN_ABORT:"in:abort",IN_ERROR:"in:error",IN_SUCCESS:"in:success",IN_LOAD:"in:load",IN_COMPLETE:"in:complete",PROC_PROGRESS:"proc:progress",PROC_COMPLETE:"proc:complete"},j={};return j.create=function(a){return new d(a)},j.isHTML5=d.prototype.isHTML5,j.EVT=i,j}]),b});
//# sourceMappingURL=angular-file-process.min.map