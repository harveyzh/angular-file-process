/*
  angular-file-process v0.0.1
  https://github.com/madwyn/angular-file-process
 */

!function(a,b){return"function"==typeof define&&define.amd?void define("angular-file-process-uploader",["angular"],function(a){return b(a)}):b(a)}(angular||null,function(a){var b=a.module("fileProcUploader",[]);return b.factory("$fileProcUploader",["$fileProcess",function(b){"use strict";function c(){}return c.prototype={constructor:c,_construct:function(){a.extend(this,{url:"/",alias:"file",method:"POST",headers:{},formData:[],_reader:new FileReader})},_destruct:function(){this._form&&this._form.remove(),this._input&&this._input.remove(),delete this._form,delete this._input},_process:function(){var a=this.proc.isHTML5?"_xhrTransport":"_iframeTransport";this[a](this)},_abort:function(){var a=this.proc.isHTML5?"_xhr":"_form";this[a]&&this[a].abort()},_xhrTransport:function(c){var d=c._xhr=new XMLHttpRequest,e=new FormData,f=c.proc;c.formData.forEach(function(b){a.forEach(b,function(a,b){e.append(b,a)})}),e.append(c.alias,c.file),d.upload.onprogress=function(a){var d=a.lengthComputable?100*a.loaded/a.total:0;f.trigger(b.EVT.IN_PROGRESS,c,Math.round(d))},d.onload=function(){var a=this._transformResponse(d.response),e=this._isSuccessCode(d.status)?b.EVT.IN_SUCCESS:b.EVT.IN_ERROR;f.trigger(e,c,d,a)},d.onerror=function(){f.trigger(b.EVT.IN_ERROR,c,d)},d.onabort=function(){f.trigger(b.EVT.IN_ABORT,c,d)},d.open(c.method,c.url,!0),d.withCredentials=c.withCredentials,a.forEach(c.headers,function(a,b){d.setRequestHeader(b,a)}),console.log("this is: "+c.file.name),d.send(e)},_iframeTransport:function(c){var d=a.element('<form style="display: none;" />'),e=a.element('<iframe name="iframeTransport'+Date.now()+'">'),f=c._input,g=c.proc;c._form&&c._form.replaceWith(f),c._form=d,f.prop("name",c.alias),c.formData.forEach(function(b){a.forEach(b,function(b,c){d.append(a.element('<input type="hidden" name="'+c+'" value="'+b+'" />'))})}),d.prop({action:c.url,method:"POST",target:e.prop("name"),enctype:"multipart/form-data",encoding:"multipart/form-data"}),e.bind("load",function(){var a=e[0].contentDocument.body.innerHTML,d={response:a,status:200,dummy:!0},f=this._transformResponse(d.response);g.trigger(b.EVT.IN_LOAD,c,d,f)}),d.abort=function(){var a={status:0,dummy:!0};e.unbind("load").prop("src","javascript:false;"),d.replaceWith(f),g.trigger(b.EVT.IN_ABORT,c,a)},f.after(d),d.append(f).append(e),d[0].submit()},_isSuccessCode:function(a){return a>=200&&300>a||304===a},_transformResponse:function(a){return $http.defaults.transformResponse.forEach(function(b){a=b(a)}),a}},c}]),b});
//# sourceMappingURL=fileProcUploader.min.map